{% extends "template.njk" %}

{% from "accordion/macro.njk"        import govukAccordion %}
{% from "back-link/macro.njk"        import govukBackLink %}
{% from "breadcrumbs/macro.njk"      import govukBreadcrumbs %}
{% from "button/macro.njk"           import govukButton %}
{% from "character-count/macro.njk"  import govukCharacterCount %}
{% from "checkboxes/macro.njk"       import govukCheckboxes %}
{% from "date-input/macro.njk"       import govukDateInput %}
{% from "details/macro.njk"          import govukDetails %}
{% from "error-message/macro.njk"    import govukErrorMessage %}
{% from "error-summary/macro.njk"    import govukErrorSummary %}
{% from "fieldset/macro.njk"         import govukFieldset %}
{% from "file-upload/macro.njk"      import govukFileUpload %}
{% from "input/macro.njk"            import govukInput %}
{% from "inset-text/macro.njk"       import govukInsetText %}
{% from "panel/macro.njk"            import govukPanel %}
{% from "phase-banner/macro.njk"     import govukPhaseBanner %}
{% from "radios/macro.njk"           import govukRadios %}
{% from "select/macro.njk"           import govukSelect %}
{% from "skip-link/macro.njk"        import govukSkipLink %}
{% from "summary-list/macro.njk"     import govukSummaryList %}
{% from "table/macro.njk"            import govukTable %}
{% from "tabs/macro.njk"             import govukTabs %}
{% from "tag/macro.njk"              import govukTag %}
{% from "textarea/macro.njk"         import govukTextarea %}
{% from "warning-text/macro.njk"     import govukWarningText %}

{% from "_components/autocomplete/macro.njk" import appAutocomplete %}
{% from "_components/cookie-banner/macro.njk" import appCookieBanner %}
{% from "_components/related/macro.njk" import appRelated %}
{% from "_components/task-list/macro.njk" import appTaskList %}

{# Set application status based on question completion #}
{% if data["candidate"]["nationality"] and
  data["contact-details"]["address"] and
  data["qualifications"] and
  data["subject-knowledge"] and
  data["language-skills"] and
  data["work-history"] and
  data["school-experience"] and
  data["referees"] and
  data["vocation"]
%}
  {% set applicationStatus = "complete" %}
{% elif data["candidate"]["nationality"] or
  data["contact-details"]["address"] or
  data["qualifications"] or
  data["subject-knowledge"] or
  data["language-skills"] or
  data["work-history"] or
  data["school-experience"] or
  data["referees"] or
  data["vocation"] == true
%}
  {% set applicationStatus = "incomplete" %}
{% else %}
  {% set applicationStatus = "unbegun" %}
{% endif %}

{# Set breadcrumbs for profile question pages #}
{% set profileBreadcrumbItems = [{
  text: "Home",
  href: "/dashboard"
}, {
  text: "Review your application",
  href: referrer
}, {
  text: title
}] if referrer | includes('/apply/') else [{
  text: "Home",
  href: "/dashboard"
}, {
  text: "Personal teaching profile",
  href: "/profile"
}, {
  text: title
}] %}

{% block head %}
  {% include "_includes/head.njk" %}
{% endblock %}

{% block pageTitle %}
  {% if title %}{{ title }} - {% endif %}{{ serviceName }} - GOV.UK
{% endblock %}

{% block header %}
  {% if shouldShowCookieMessage %}
  {{ appCookieBanner({
    text: cookieText
  })}}
  {% endif %}

  {% set candidateName = data.candidate["first-name"] + " " + data.candidate["family-name"] %}
  {{ govukHeader({
    homepageUrl: "https://www.gov.uk",
    serviceName: serviceName,
    serviceUrl: "/",
    containerClasses: "govuk-width-container",
    navigation: (([{
      href: "/",
      text: "Sign out (" + candidateName + ")"
    }] if data.candidate) if isExternal != true)
  }) }}
{% endblock %}

{% block beforeContent %}
  {{ govukPhaseBanner({
    tag: {
      text: "prototype"
    },
    html: "This is a prototype of a new service. Some parts of this prototype do not work yet."
  }) }}
  {% block pageNavigation %}
  {% endblock %}
{% endblock %}

{% if useAutoStoreData %}
  {% block footer %}
    {{ govukFooter({
      meta: {
        items: [{
          href: "https://govuk-prototype-kit.herokuapp.com/",
          text: "GOV.UK Prototype Kit " + releaseVersion
        }, {
          href: "/prototype-admin/clear-data",
          text: "Clear data"
        }, {
          href: "/prototype-admin/settings",
          text: "Settings"
        }]
      }
    }) }}
  {% endblock %}
{% endif %}

{% block bodyEnd %}
  {% block scripts %}
    {{ data | log }}
    {% include "_includes/scripts.njk" %}
    {% block pageScripts %}{% endblock %}
  {% endblock %}
{% endblock %}
