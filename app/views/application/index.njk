{% extends "_content.njk" %}
{% set applicationPath = "/application/" + applicationId %}
{% set status = applicationValue(["status"]) %}
{% set incompleteTagClass = "govuk-tag--grey" %}
{% set incompleteTagText = "Incomplete" %}
{% set notStartedTagClass = "govuk-tag--grey" %}
{% set notStartedTagText = "Not started" %}
{% set referrer = applicationPath %}
{% set international = applicationValue(["candidate", "other-nationality"]) or applicationValue(["candidate", "multiple-nationalities"]) %}

{% if status == "started" %}
  {% if applicationValue('apply2') %}
    {% set title = "Your new application" %}
  {% else %}
    {% set title = "Your application" %}
  {% endif %}
  {% set tagText = "Completed" %}
  {% set reviewText = "Check your answers before submitting" %}
{% endif %}
{% set hasSecondary = true %}

{% block beforePageTitle %}
  {% if showCopiedBanner %}
    {{ appBanner({
      html: "<h2 class=\"govuk-heading-m\">We’ve copied your application. Please review all sections.</h2>",
      type: "success",
      icon: false
    }) }}
  {% endif %}

  {% if closed %}
    {{ appBanner({
      html: "<h2 class=\"govuk-heading-m\">Applications for courses starting this year have now closed</h2><p class=\"govuk-body-l\">Submit your application from 13 October for courses starting in 2021.</p>",
      icon: false
    }) }}
  {% endif %}
{% endblock %}

{% block pageNavigation %}
  {% if hasSubmittedApplications() %}
    {{ govukBreadcrumbs({
      items: [{
        text: "Application dashboard",
        href: "/applications"
      }, {
        text: title | safe
      }]
    }) }}
  {% endif %}
{% endblock %}

{% block beforePrimary %}
  <h1 class="govuk-heading-xl govuk-!-margin-bottom-2">{{ title | safe }}</h1>
  <p class="govuk-hint govuk-!-margin-bottom-8">Last saved on {{ "now" | date("d MMMM yyyy") }} at {{ "now" | date("t") }}</p>
{% endblock %}

{% block primary %}
{% set rejectionHtml %}
  {% set status = item.status or application.status or "Submitted" %}
  {% set statusHtml %}
    {{ govukTag({
      classes: "app-tag " + status | statusClass,
      text: status | capitalize
    }) }}
  {% endset %}

  {% set courseHtml1 %}
    {% set reasonHtml %}
      <h4 class="govuk-heading-s govuk-!-margin-bottom-0">Quality of application</h4>
      <p class="govuk-body">Your subject knowledge could be improved.</p>
      <p class="govuk-body">Details: Understand the purpose of PE in schools and the learn more about the procedures related to safeguarding.</p>

      <h4 class="govuk-heading-s govuk-!-margin-bottom-0">Qualifications</h4>
      <p class="govuk-body">No Science GCSE grade 4 (C) or above, or valid equivalent.</p>
    {% endset %}
    {{ govukSummaryList({
      rows: [{
        key: {
          text: "Course"
        },
        value: {
          html: "Primary (2XT2)"
        }
      }, {
        key: {
          text: "Status"
        },
        value: {
          html: govukTag({
            classes: "app-tag govuk-tag--pink",
            text: "Unsuccessful"
          })
        }
      }, {
        key: {
          text: "Feedback"
        },
        value: {
          html: reasonHtml
        }
      }]
    }) }}
  {% endset %}

  {% set courseHtml2 %}
    {% set reasonHtml %}
      <h4 class="govuk-heading-s govuk-!-margin-bottom-0">Course full</h4>
      <p class="govuk-body">We’re sorry to tell you that the course you applied to was full.</p>
    {% endset %}
    {{ govukSummaryList({
      rows: [{
        key: {
          text: "Course"
        },
        value: {
          html: "Primary (3-7) (2VLT)"
        }
      }, {
        key: {
          text: "Status"
        },
        value: {
          html: govukTag({
            classes: "app-tag govuk-tag--pink",
            text: "Unsuccessful"
          })
        }
      }, {
        key: {
          text: "Feedback"
        },
        value: {
          html: reasonHtml
        }
      }]
    }) }}
  {% endset %}

  {% set courseHtml3 %}
    {% set reasonHtml %}
      <h4 class="govuk-heading-s govuk-!-margin-bottom-0">Course full</h4>
      <p class="govuk-body">We’re sorry to tell you that the course you applied to was full.</p>
    {% endset %}
    {{ govukSummaryList({
      rows: [{
        key: {
          text: "Course"
        },
        value: {
          html: "Primary (X100)"
        }
      }, {
        key: {
          text: "Status"
        },
        value: {
          html: govukTag({
            classes: "app-tag govuk-tag--orange",
            text: "Application withdrawn"
          })
        }
      }]
    }) }}
  {% endset %}

  {{ appSummaryCard({
    classes: "govuk-!-margin-bottom-6",
    headingLevel: 3,
    titleText: "Gorse SCITT",
    html: courseHtml1
  }) }}

  {{ appSummaryCard({
    classes: "govuk-!-margin-bottom-6",
    headingLevel: 3,
    titleText: "Leeds Trinity University",
    html: courseHtml2
  }) }}

  {{ appSummaryCard({
    classes: "govuk-!-margin-bottom-6",
    headingLevel: 3,
    titleText: "Bradford College",
    html: courseHtml3
  }) }}
{% endset %}

  {% if applicationValue(["apply2"]) %}
    {{ govukDetails({
      summaryText: "See feedback from your previous application",
      html: rejectionHtml
    }) }}
  {% endif %}

  {% if applicationValue(["apply2"]) %}
    <h2 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-bottom-2">Course choice</h2>
  {% else %}
    <h2 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-bottom-2">Course choices</h2>
    {% if closed == "true" %}
      <p>You can apply for courses from 13 October.</p>
    {% else %}
      <p class="govuk-body">You can apply for up to 3 courses.</p>
    {% endif %}
  {% endif %}

  {% if applicationValue(["apply2"]) %}
    {% if applicationValue(["completed", "choices"]) %}
      {% set choiceTagText = tagText %}
      {% set choiceTagClass = tagClass %}
    {% else %}
      {% set choiceTagText = notStartedTagText%}
      {% set choiceTagClass = notStartedTagClass %}
    {% endif %}
  {% else %}
    {% if applicationValue(["completed", "choices"]) %}
      {% set choiceTagText = tagText %}
    {% else %}
      {% set choiceTagText = incompleteTagText %}
      {% set choiceTagClass = incompleteTagClass %}
    {% endif %}
  {% endif %}

  {{ appTaskList({
    classes: "govuk-!-margin-bottom-8",
    items: [{
      text: "Course choice" if applicationValue(["apply2"]) else "Course choices",
      href: applicationPath + "/choices",
      id: "personal-details",
      tag: {
        classes: choiceTagClass,
        text: choiceTagText
      }
    }]
  }) if not closed }}

  <h2 class="govuk-heading-m govuk-!-font-size-27">References</h2>
  {% if applicationValue(["referees"]) | length > 0 %}
    {% set referencesUrl = applicationPath + "/references/review" %}
  {% else %}
    {% set referencesUrl = applicationPath + "/references/type/first" %}
  {% endif %}

  {{ appTaskList({
    classes: "govuk-!-margin-bottom-8",
    items: [{
      text: "Referees",
      href: referencesUrl,
      id: "references",
      tag: {
        classes: tagClass if applicationValue(["completed", "references"]) | length > 0 else incompleteTagClass,
        text: tagText if applicationValue(["completed", "references"]) |length > 0 else incompleteTagText
      }
    }]
  }) }}

  <h2 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-top-4">About you</h2>
  {{ appTaskList({
    classes: "govuk-!-margin-bottom-8",
    items: [{
      text: "Personal details",
      href: applicationPath + "/personal-details" + ("/review" if applicationValue(["candidate"]) | length > 0),
      id: "personal-details",
      tag: {
        classes: tagClass if applicationValue(["completed", "personal-details"]) else incompleteTagClass,
        text: tagText if applicationValue(["completed", "personal-details"]) else incompleteTagText
      }
    }, {
      text: "Contact details",
      href: applicationPath + "/contact-details" + ("/review" if applicationValue(["contact-details", "address"])),
      id: "contact-details",
      tag: {
        classes: tagClass if applicationValue(["completed", "contact-details"]) else incompleteTagClass,
        text: tagText if applicationValue(["completed", "contact-details"]) else incompleteTagText
      }
    }, {
      text: "Work history",
      href: applicationPath + "/work-history" + ("/review" if applicationValue("work-history") | length > 0),
      id: "work-history",
      tag: {
        classes: tagClass if applicationValue(["completed", "work-history"]) else incompleteTagClass,
        text: tagText if applicationValue(["completed", "work-history"]) else incompleteTagText
      }
    }, {
      text: "Unpaid experience and volunteering",
      href: applicationPath + "/school-experience" + ("/review" if applicationValue("school-experience") | length > 0),
      id: "school-experience",
      tag: {
        classes: tagClass if applicationValue(["completed", "school-experience"]) else incompleteTagClass,
        text: tagText if applicationValue(["completed", "school-experience"]) else incompleteTagText
      }
    }, {
     text: "Asking for support if you have a disability",
     href: applicationPath + "/reasonable-adjustments" + ("/review" if applicationValue("reasonable-adjustments") | length > 0),
     id: "reasonable-adjustments",
     tag: {
        classes: tagClass if applicationValue(["completed", "reasonable-adjustments"]) else incompleteTagClass,
        text: tagText if applicationValue(["completed", "reasonable-adjustments"]) else incompleteTagText
     }
   }, {
    text: "Declaring any safeguarding issues",
    href: applicationPath + "/suitability" + ("/review" if applicationValue("suitability") | length > 0),
    id: "suitability",
    tag: {
      classes: tagClass if applicationValue(["completed", "suitability"]) else incompleteTagClass,
      text: tagText if applicationValue(["completed", "suitability"]) else incompleteTagText
    }
  }]
  }) }}

  <h2 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-bottom-2">Qualifications</h2>
  {{ appTaskList({
    classes: "govuk-!-margin-bottom-8",
    items: [{
      text: "Degree",
      href: applicationPath + "/degree" + ("/review" if applicationValue(["degree"]) | length > 0 else "/add"),
      id: "degree",
      tag: {
        classes: tagClass if applicationValue(["completed", "degree"]) else incompleteTagClass,
        text: tagText if applicationValue(["completed", "degree"]) else incompleteTagText
      }
    }, {
      text: "Maths GCSE or equivalent",
      href: applicationPath + "/gcse/maths" + ("/review" if applicationValue(["gcse", "maths"]) | length > 0),
      id: "maths-gcse",
      tag: {
        classes: tagClass if applicationValue(["completed", "maths"]) else incompleteTagClass,
        text: tagText if applicationValue(["completed", "maths"]) else incompleteTagText
      }
    }, {
      text: "English GCSE or equivalent",
      href: applicationPath + "/gcse/english" + ("/review" if applicationValue(["gcse", "english"]) | length > 0),
      id: "english-gcse",
      tag: {
        classes: tagClass if applicationValue(["completed", "english"]) else incompleteTagClass,
        text: tagText if applicationValue(["completed", "english"]) else incompleteTagText
      }
    }, {
      text: "Science GCSE or equivalent",
      href: applicationPath + "/gcse/science" + ("/review" if applicationValue(["gcse", "science"]) | length > 0),
      id: "science-gcse",
      tag: {
        classes: tagClass if applicationValue(["completed", "science"]) else incompleteTagClass,
        text: tagText if applicationValue(["completed", "science"]) else incompleteTagText
      }
    } if hasPrimaryChoices() or applicationValue(["gcse", "science"]), {
      text: "Academic and other relevant qualifications",
      href: applicationPath + "/other-qualifications" + ("/review" if applicationValue(["other-qualifications"]) | length > 0 else "/add"),
      id: "other-qualifications",
      tag: {
        classes: tagClass if applicationValue(["completed", "other-qualifications"]) | length > 0 else incompleteTagClass,
        text: tagText if applicationValue(["completed", "other-qualifications"]) |length > 0 else incompleteTagText
      }
    }, {
      text: "English as a foreign language",
      href: applicationPath + "/english-language" + ("/review" if applicationValue(["english-language"]) | length > 0),
      id: "english-language",
      tag: {
        classes: tagClass if applicationValue(["completed", "english-language"]) | length > 0 else incompleteTagClass,
        text: tagText if applicationValue(["completed", "english-language"]) |length > 0 else incompleteTagText
      }
    } if international]
  }) }}

  <h2 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-bottom-2">Personal statement</h2>
  {{ appTaskList({
    classes: "govuk-!-margin-bottom-8",
    items: [{
      text: "Why do you want to be a teacher?",
      href: applicationPath + "/personal-statement" + ("/review" if applicationValue(["personal-statement"]) | length > 0),
      id: "personal-statement",
      tag: {
        classes: tagClass if applicationValue(["completed", "personal-statement"]) | length > 0 else incompleteTagClass,
        text: tagText if applicationValue(["completed", "personal-statement"]) |length > 0 else incompleteTagText
      }
    }, {
      text: "Your knowledge about the subject you want to teach",
      href: applicationPath + "/subject-knowledge" + ("/review" if applicationValue(["subject-knowledge"]) | length > 0),
      id: "subject-knowledge",
      tag: {
        classes: tagClass if applicationValue(["completed", "subject-knowledge"]) | length > 0 else incompleteTagClass,
        text: tagText if applicationValue(["completed", "subject-knowledge"]) |length > 0 else incompleteTagText
      }
    }, {
      text: "Interview needs",
      href: applicationPath + "/interview" + ("/review" if applicationValue(["interview"]) | length > 0),
      id: "interview",
      tag: {
        classes: tagClass if applicationValue(["completed", "interview"]) | length > 0 else incompleteTagClass,
        text: tagText if applicationValue(["completed", "interview"]) |length > 0 else incompleteTagText
      }
    }]
  }) }}

  {% if closed %}
    <h2 class="govuk-heading-m govuk-!-font-size-27">Review</h2>
    <p class="govuk-body">Applications for courses starting in 2021 open from 13 October. You can continue to make changes to your application until then.</p>
    {{ govukButton({
      classes: "govuk-button--secondary",
      text: "Review your application",
      href: applicationPath + "/review?closed=true"
    }) }}
  {% else %}
    <h2 class="govuk-heading-m govuk-!-font-size-27">Check and submit</h2>
    {{ govukButton({
      text: "Check and submit your application",
      href: applicationPath + "/review"
    }) }}
  {% endif %}

{% endblock %}

{% block secondary %}
  {% include "_includes/need-help.njk" %}
{% endblock %}
