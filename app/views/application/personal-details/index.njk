{% extends "_form.njk" %}

{% set title = "Personal details" %}

{% block pageNavigation %}
  {% if referrer %}
    {{ govukBackLink({
      href: referrer
    }) }}
  {% else %}
    {{ govukBackLink({
      href: "/application/" + applicationId,
      text: "Back to application"
    }) }}
  {% endif %}
{% endblock %}

{% block primary %}
  {{ govukInput({
    label: {
      text: "First name",
      classes: "govuk-label--m"
    },
    hint: {
      text: "Or given names"
    },
    autocomplete: "given-name",
    attributes: {
      spellcheck: "false"
    }
  } | decorateApplicationAttributes(["candidate", "given-name"])) }}

  {{ govukInput({
    label: {
      text: "Last name",
      classes: "govuk-label--m"
    },
    hint: {
      text: "Or family name"
    },
    autocomplete: "family-name",
    attributes: {
      spellcheck: "false"
    }
  } | decorateApplicationAttributes(["candidate", "family-name"])) }}

  {{ govukDateInput({
    fieldset: {
      legend: {
        text: "Date of birth",
        classes: "govuk-fieldset__legend--m"
      }
    },
    hint: {
      text: "For example, 31 3 1980"
    },
    id: "candidate-date-of-birth",
    items: [{
      classes: "govuk-input--width-2",
      label: "Day",
      name: "applications[" + applicationId + "][candidate][date-of-birth][day]",
      value: applicationValue(["candidate", "date-of-birth", "day"]),
      autocomplete: "bday-day"
    }, {
      classes: "govuk-input--width-2",
      label: "Month",
      name: "applications[" + applicationId + "][candidate][date-of-birth][month]",
      value: applicationValue(["candidate", "date-of-birth", "month"]),
      autocomplete: "bday-month"
    }, {
      classes: "govuk-input--width-4",
      label: "Year",
      name: "applications[" + applicationId + "][candidate][date-of-birth][year]",
      value: applicationValue(["candidate", "date-of-birth", "year"]),
      autocomplete: "bday-year"
    }]
  }) }}

  {% if data.flags.nationality %}
    {{ appAutocomplete({
      label: {
        text: "Nationality",
        classes: "govuk-label--m"
      },
      items: nationalities
    } | decorateApplicationAttributes(["candidate", "nationality"])) }}

    {% set anotherNationality %}
      {{ appAutocomplete({
        label: {
          text: "Second nationality"
        },
        items: nationalities
      } | decorateApplicationAttributes(["candidate", "second-nationality"])) }}
    {% endset -%}

    {{ govukDetails({
      summaryText: "Add another nationality",
      html: anotherNationality,
      open: ["candidate", "second-nationality"] | ifSetForApplication
    }) }}
  {% endif %}

  {% set englishDetailHtml %}
    {{ govukCharacterCount({
      label: {
        text: "If you are bilingual or very familiar with languages other than English, you can tell us about them here."
      },
      maxwords: 200
    } | decorateApplicationAttributes(["candidate", "language-skills", "other"])) }}
  {% endset -%}
  {% set otherDetailHtml %}
    {{ govukCharacterCount({
      label: {
        text: "Please tell us about your English language qualifications (including grades or scores), and give details of other languages you are fluent in."
      },
      maxwords: 200
    } | decorateApplicationAttributes(["candidate", "language-skills", "english-qualifications"])) }}
  {% endset -%}

    {{ govukRadios({
      fieldset: {
        attributes: {
          "data-module": "clear-hidden"
        },
        legend: {
          text: "Is English your main language?",
          classes: "govuk-label--m"
        }
      },
      items: [{
        text: "Yes",
        conditional: {
          html: englishDetailHtml
        }
      }, {
        text: "No",
        conditional: {
          html: otherDetailHtml
        }
      }]
    } | decorateApplicationAttributes(["candidate", "language-skills", "english-is-main"])) }}

  {{ govukButton({
    text: "Save and continue"
  }) }}
{% endblock %}

{% block pageScripts %}
  <script src="/public/javascripts/autocomplete.min.js"></script>
  <script>
    accessibleAutocomplete.enhanceSelectElement({
      selectElement: document.querySelector('#candidate-nationality'),
      defaultValue: '{{ applicationValue(["candidate", "nationality"]) }}'
    })
    accessibleAutocomplete.enhanceSelectElement({
      selectElement: document.querySelector('#candidate-second-nationality'),
      defaultValue: '{{ applicationValue(["candidate", "second-nationality"]) }}'
    })
  </script>
{% endblock %}
