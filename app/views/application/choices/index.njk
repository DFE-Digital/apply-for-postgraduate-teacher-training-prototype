{% extends "_form-wide.njk" %}

{% set applicationPath = "/application/" + applicationId %}
{% set formaction = applicationPath %}
{% set choices = applicationValue("choices") | toArray %}

{% set choicesRemaining = 3 - ((pendingChoices() | length) + (choices | length))  %}
{% if choicesRemaining >= 1 or (choices | length) > 1 %}
  {% set title = "Course choices" %}
{% else %}
  {% set title = "Course choice" %}
{% endif %}

{% block pageNavigation %}
  {% if not applicationValue('welcomeFlow') %}
    {% if referrer %}
      {{ govukBackLink({
        href: referrer
      }) }}
    {% else %}
      {{ govukBackLink({
        href: "/application/" + applicationId,
        text: "Back to application"
      }) }}
    {% endif %}
  {% endif %}
{% endblock %}

{% block primary %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">

      {% if choicesRemaining != 0 %}

        {% set addAnotherHtml %}
          <div class="govuk-!-width-two-thirds">
            <p class="govuk-body">
              You can apply to
              {% if choicesRemaining == 1 %}
                1 course.
              {% else %}
                {{ choicesRemaining }} courses.
              {% endif %}
            </p>
          </div>

          {{ govukButton({
            classes: "govuk-button--secondary",
            text: "Add another course",
            href: applicationPath + "/choices/add?from=choices"
          }) }}
        {% endset %}

        {{ govukInsetText({html: addAnotherHtml}) }}
      {% endif %}

      {% set referrer = applicationPath + "/choices" %}
      {% set canAmend = true %}
      {% set showChoiceStatus = false %}
      {% include "_includes/review/choices.njk" %}


      {{ govukRadios({
        fieldset: {
          classes: "govuk-!-width-two-thirds",
          legend: {
            text: "Have you completed this section?",
            classes: "govuk-fieldset__legend--m"
          }
        },
        hint: {
          text: "You can add " + choicesRemaining + (" more courses" if choicesRemaining > 1 else " more course")
        } if choicesRemaining != 0,
        items: [{
          value: "true",
          text: "Yes, I’ve completed this section"
        }, {
          value: "false",
          text: "No, I’ll come back to it later"
        }]
      } | decorateApplicationAttributes(["completed", "choices"])) }}

      {{ govukButton({
        text: "Continue"
      }) }}
    </div>
  </div>
{% endblock %}
