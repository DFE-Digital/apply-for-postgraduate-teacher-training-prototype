{% extends "_form.njk" %}

{% set title = "Which course are you applying to?" %}
{% set formaction = paths.next %}
{% set editing = applicationValue(["choices", choiceId]) %}
{% if editing %}
  {% set providerCode = applicationValue(["choices", choiceId, "providerCode"]) %}
{% else %}
  {% set providerCode = applicationValue(["temporaryChoices", choiceId, "provider"]) | providerCode %}
{% endif %}

{% block pageNavigation %}
  {{ govukBackLink({
    href: paths.back
  }) }}
{% endblock %}

{% block primary %}
  <div class="govuk-form-group">
    <label for="courses-{{ choiceId }}-course" class="govuk-label">Enter course name and code</label>
    <div id="course-autocomplete-container"></div>
  </div>

  {{ govukButton({
    text: "Continue"
  }) }}
{% endblock %}

{% block pageScripts %}
  <script src="/public/javascripts/autocomplete.min.js"></script>
  <script>
    {% set provider = providers[providerCode] %}
    {% if editing %}
      {% set defaultValue = provider.courses[applicationValue(["choices", choiceId, "courseCode"])].name_and_code %}

      accessibleAutocomplete({
        defaultValue: "",
        name: "applications[{{ applicationId }}][temporaryChoices][{{ choiceId }}][course]",
        element: document.querySelector('#course-autocomplete-container'),
        id: 'courses-{{ choiceId }}-course',
        showAllValues: true,
        source: [
          {% for id, item in provider.courses %}"{{ item.name_and_code }}",{% endfor %}
        ]
      })
    {% else %}
      accessibleAutocomplete({
        defaultValue: '{{ applicationValue(["temporaryChoices", choiceId, "course"]) }}',
        name: "applications[{{ applicationId }}][temporaryChoices][{{ choiceId }}][course]",
        element: document.querySelector('#course-autocomplete-container'),
        id: 'courses-{{ choiceId }}-course',
        showAllValues: true,
        source: [
          {% for id, item in provider.courses %}"{{ item.name_and_code }}",{% endfor %}
        ]
      })
    {% endif %}
  </script>
{% endblock %}
