{% extends "_form.njk" %}

{% set providerOnDfEApply = true %}
{% set title = "Which course are you applying to?" if providerOnDfEApply else "You need to apply for this course on UCAS" %}
{% set formaction = paths.next %}
{% set applicationPath = "/application/" + applicationId %}
{% set editing = applicationValue(["choices", choiceId]) %}
{% if editing %}
  {% set providerCode = applicationValue(["choices", choiceId, "providerCode"]) %}
{% else %}
  {% set providerCode = applicationValue(["temporaryChoices", choiceId, "provider"]) | providerCode %}
{% endif %}

{% block pageNavigation %}
  {{ govukBackLink({
    href: paths.back
  }) }}
{% endblock %}

{% block primary %}
  {% if providerOnDfEApply %}
    <div class="govuk-form-group">
      <label for="courses-{{ choiceId }}-course" class="govuk-label">Enter course name and code</label>
      <div id="course-autocomplete-container"></div>
    </div>

    {{ govukButton({
      text: "Continue"
    }) }}
  {% else %}
    <p>For now, the Department for Education’s Apply for teacher training service is limited to just a few training providers.</p>
    <p>The course you’ve chosen is not signed up to the new service. This means you must apply for it using UCAS.</p>
    <p>You’ll need to register with UCAS before you can apply.</p>

    {# <p>Visit Get into Teaching for <a href="/apply/get-into-teaching">guidance on applying for teacher training through UCAS</a>. #}

    <p>
      <a href="https://2020.teachertraining.apply.ucas.com/apply/student/login.do" class="govuk-button govuk-!-margin-bottom-0">Apply on UCAS</a>
    </p>

    <p class="govuk-body govuk-!-font-weight-bold">You can also:</p>
    <p class="govuk-body"><a href="/apply/get-into-teaching">Learn more about changes to teacher training applications</a></p>
    <p class="govuk-body"><a href="/apply/providers">Check the list of training providers</a> signed up to Apply for teacher training</p>

    <p class="govuk-body">
      <a href="{{ applicationPath }}" class="govuk-button govuk-button--secondary">Return to your application</a>
    </p>
  {% endif %}
{% endblock %}

{% block pageScripts %}
  {% if providerOnDfEApply %}
    <script src="/public/javascripts/autocomplete.min.js"></script>
    <script>
      {% set provider = providers[providerCode] %}
      {% if editing %}
        {% set defaultValue = provider.courses[applicationValue(["choices", choiceId, "courseCode"])].name_and_code %}

        accessibleAutocomplete({
          defaultValue: "",
          name: "applications[{{ applicationId }}][temporaryChoices][{{ choiceId }}][course]",
          element: document.querySelector('#course-autocomplete-container'),
          id: 'courses-{{ choiceId }}-course',
          showAllValues: true,
          source: [
            {% for id, item in provider.courses %}"{{ item.name_and_code }}",{% endfor %}
          ]
        })
      {% else %}
        accessibleAutocomplete({
          defaultValue: '{{ applicationValue(["temporaryChoices", choiceId, "course"]) }}',
          name: "applications[{{ applicationId }}][temporaryChoices][{{ choiceId }}][course]",
          element: document.querySelector('#course-autocomplete-container'),
          id: 'courses-{{ choiceId }}-course',
          showAllValues: true,
          source: [
            {% for id, item in provider.courses %}"{{ item.name_and_code }}",{% endfor %}
          ]
        })
      {% endif %}
    </script>
  {% endif %}
{% endblock %}
