{% extends "_form.njk" %}

{% set applicationPath = "/application/" + applicationId %}
{% set title = "Which institution did you study at?" %}
{% set international = applicationValue(["degree", id, "provenance"]) == "international" %}

{% block pageNavigation %}
  {{ govukBackLink({
    href: paths.back
  }) }}
{% endblock %}

{% block primary %}
  {% if international %}
    {{ govukInput({
      label: label
    } | decorateApplicationAttributes(["degree", id, "org"])) }}
  {% else %}
    <div class="govuk-form-group">
      <label class="govuk-label" for="degree-{{ id }}-subject">Select an institution</label>
      <div id="org-autocomplete-container"></div>
    </div>
  {% endif %}

  {{ govukButton({
    text: "Save and continue"
  }) }}
{% endblock %}

{% if not international %}
  {% block pageScripts %}
    <script src="/public/javascripts/autocomplete.min.js"></script>
    <script>
      accessibleAutocomplete({
        name: "applications[{{ applicationId }}][degree][{{ id }}][org]",
        minLength: 2,
        element: document.querySelector('#org-autocomplete-container'),
        id: 'degree-{{ id }}-org',
        placeholder: false,
        showAllValues: true,
        defaultValue: '{{ applicationValue(["degree", id, "org"]) }}',
        showNoOptionsFound: true,
        source: [
          {% for item in degree.orgs %}"{{ item }}",{% endfor %}
        ],
        tNoResults: () => 'No results found. Enter your institution.'
      })
    </script>
  {% endblock %}
{% endif %}