{% extends "_content.njk" %}

{% set title = "Your application" %}

{% block primary %}
  {% for applicationId, application in data.applications %}
    {% if application.status == "submitted" %}
      <p>You submitted your application on {{ "now" | date("d MMMM yyyy") }}. Training providers must respond to you by {{ 40 | nowPlusDays("d MMMM yyyy") }}.</p>

      {% if true or (notAlreadyEdited and within1WeekOfSubmitting) %}
      <div class="govuk-inset-text">
        {# {{ govukWarningText({
          text: "You’ve edited your application but your changes haven’t been submitted yet",
          iconFallbackText: "Warning"
        }) }} #}

        <p>You have 7 days (until {{ 7 | nowPlusDays("d MMMM yyyy") }}) to withdraw an application and resubmit it to a different course or provider. When you withdraw, you’ll be able to edit your application before you resubmit.</p>
        <p>You can withdraw each of your 3 applications no more than once.</p>

        {{ govukButton({
          text: "Edit your application",
          href: "/application/" + applicationId
        }) }}
      </div>
      {% else %}
        <p>
          <a href="/application/{{ applicationId }}/submitted">View your application</a>
        </p>
      {% endif %}

      <hr class="govuk-section-break govuk-section-break--l">

      <h2 class="govuk-heading-l">Courses you’ve applied to</h2>

      {% for id, c in application.courses %}
        {% set provider = providers[c.providerCode] %}
        {% set course = provider.courses[c.courseCode] %}
        <h3 class="govuk-heading-m">{{ provider.name }}</h3>
        {{ govukSummaryList({
          classes: "app-summary",
          rows: [{
            key: {
              text: "Course"
            },
            value: {
              html: "<a href=\"#\">" + course.name_and_code + "</a>"
            }
          }, {
            key: {
              text: "Description"
            },
            value: {
              html: course.description
            }
          }, {
            key: {
              text: "Location"
            },
            value: {
              html: c.locationName + "<br />" + c.locationAddress
            }
          }, {
            key: {
              text: "Provider response"
            },
            value: {
              html: "No response yet"
            }
          }]
        }) }}
      {% endfor %}

      <hr class="govuk-section-break govuk-section-break--m">

      <h2 class="govuk-heading-l">Your references</h2>
      <p>We’ve contacted your references.</p>
      <ul class="govuk-list">
      {% for id, referee in application.referees %}
        <li>{{ referee.name }} has not yet responded</li>
        {# Examples:
        [name] has responded
        [name] has been sent a reminder email
        [name] has declined to give a reference
        [name] has failed to respond before the 10-day deadline #}
      {% endfor %}
      </ul>
    {% endif %}
  {% endfor %}
{% endblock %}
