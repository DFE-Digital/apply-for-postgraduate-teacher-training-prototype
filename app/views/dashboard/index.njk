{% extends "_content-wide.njk" %}

{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/button/macro.njk" import govukButton %}

{% set choices = application.choices | toArray %}

{% if choices | length > 1  %}
  {% set title = "Your applications" %}
{% else %}
  {% set title = "Your application" %}
{% endif %}

{% set hasSecondary = true %}
{% set applicationPath = "/application/" + applicationId %}

{% if applicationStatus %}
  {% set referrer = "/dashboard/" + applicationId + "/" + applicationStatus %}
{% else %}
  {% set referrer = "/dashboard/" + applicationId %}
{% endif %}

{% if applicationStatus == "awaiting-candidate-response" or applicationStatus == "received-one-offer" or applicationStatus == "received-two-offers" %}
  {% set statusTitle = "All your training providers have now reached a decision" %}
  {% set statusDesc = "You have 14 days (until " + 14 | nowPlusDays("d MMMM yyyy") + ") to respond to any offers. If you do not respond, your applications will be automatically withdrawn." %}
{% elif applicationStatus == "offer-received" %}
  {% set statusTitle = "Your training provider has now reached a decision" %}
  {% set statusDesc = "You have 14 days (until " + 14 | nowPlusDays("d MMMM yyyy") + ") to respond to any offers. If you do not respond, your applications will be automatically withdrawn." %}
{% elif applicationStatus == "ended-without-success" %}
  {% set statusTitle = "All your training providers have now reached a decision" %}
{% elif applicationStatus == "withdrawn" or applicationStatus == "did-not-respond-to-offer" %}
  {% set statusTitle = "You have withdrawn all your choices" %}
{% elif applicationStatus == "pending-conditions" %}
  {% set statusTitle = "You have accepted an offer" %}
  {% set statusDesc = "We’ve sent you an email to confirm this. Your training provider will be in touch with you directly to explain what happens next." %}
{% elif applicationStatus == "offer-deferred" %}
  {% set statusTitle = "Your original offer has been deferred" %}
  {% set statusDesc = "We’ve sent you an email to confirm this. Your training provider will be in touch with you directly to explain what happens next." %}
{% elif applicationStatus == "recruited" or applicationStatus == "recruited-single" %}
  {% set statusTitle = "You have met your conditions and are ready to be enrolled" %}
  {% set statusDesc = "Your training provider will be in touch with you directly to explain what happens next." %}
{% else %}
  {% if application.choices | toArray | length > 1 %}
    {% set statusTitle = "Courses you’ve applied to" %}
  {% else %}
    {% set statusTitle = "Course you’ve applied to" %}
  {% endif %}
  {% set statusDesc = "Training providers must respond by " + 56 | nowPlusDays("d MMMM yyyy") + "." %}
{% endif %}

{% block beforePrimary %}
  <h1 class="govuk-heading-xl">{{ title | safe }}</h1>
{% endblock %}

{% block primary %}

  {% set canMakeDecision = (status == "awaiting-provider-decisions") or (status == "awaiting-candidate-response" or applicationStatus == "offer-received" or applicationStatus == "received-one-offer" or applicationStatus == "received-two-offers") %}

  {% set respondToOfferHtml %}
    <h2 class="govuk-heading-m">
    {% if applicationStatus == "received-two-offers" %}
      You have received 2 conditional offers
    {% else %}
      You have received a conditional offer
    {% endif %}
    </h2>
    <p class="govuk-body-l">You have 14 days (until 4 March 2021) to accept or decline the
    {{ "offers" if applicationStatus == "received-two-offers" else "offer" }}.</p>

    <p class="govuk-body-l">Your {{ "offers" if applicationStatus == "received-two-offers" else "offer" }} will be withdrawn if you do not respond in time.</p>

    {% set buttonText %}
      Respond to  {{ "offers" if applicationStatus == "received-two-offers" else "offer" }}
    {% endset %}

    {{ govukButton({
      text: buttonText,
      href: "/application/" + applicationId + "/respond"
    }) }}
  {% endset %}

  {% if canMakeDecision == true %}
    {{ govukInsetText({
      html: respondToOfferHtml,
      classes: "app-inset-text--important govuk-!-margin-top-0"
    }) }}
  {% endif %}

  {% if application.endedWithoutSuccess == true %}

    {% set applyAgainHtml %}
      <h2 class="govuk-heading-m">
        {% if applicationStatus == "withdrawn" %}
          You withdrew your application
        {% elseif applicationStatus == "declined" %}
          You declined an offer
        {% else %}
          You did not get a place on a course this time
        {% endif %}
      </h2>

      <p class="govuk-body-l">You can apply again for courses starting in September 2021.</p>

      <p class="govuk-body-l">You have until 5 August 2021 to apply again.</p>
      {{ govukButton({
        text: "Apply again",
        href: "#"
      }) }}
    {% endset %}

    {{ govukInsetText({
      html: applyAgainHtml,
      classes: "govuk-!-margin-top-0 app-inset-text--important"
    }) }}
  {% endif %}

  {% if applicationStatus != "declined" %}
    {% if choices | length > 1 %}
      {% include "dashboard/_multiple_active_applications.njk" %}
    {% else %}
      {% include "dashboard/_single_active_application.njk" %}
    {% endif %}
  {% endif %}

  {% include "dashboard/_next_steps.njk" %}
  {% include "dashboard/_previous_applications_summary.njk" %}

{% endblock %}
