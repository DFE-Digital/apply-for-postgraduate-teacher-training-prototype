{% extends "_content.njk" %}

{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/button/macro.njk" import govukButton %}


{% set title = "Your application" %}
{% set hasSecondary = true %}
{% set applicationPath = "/application/" + applicationId %}

{% if applicationStatus %}
  {% set referrer = "/dashboard/" + applicationId + "/" + applicationStatus %}
{% else %}
  {% set referrer = "/dashboard/" + applicationId %}
{% endif %}

{% if status == "awaiting-candidate-response" or status == "received-one-offer" or status == "received-two-offers" %}
  {% set statusTitle = "All your training providers have now reached a decision" %}
  {% set statusDesc = "You have 14 days (until " + 14 | nowPlusDays("d MMMM yyyy") + ") to respond to any offers. If you do not respond, your applications will be automatically withdrawn." %}
{% elif status == "offer-received" %}
  {% set statusTitle = "Your training provider has now reached a decision" %}
  {% set statusDesc = "You have 14 days (until " + 14 | nowPlusDays("d MMMM yyyy") + ") to respond to any offers. If you do not respond, your applications will be automatically withdrawn." %}
{% elif status == "ended-without-success" %}
  {% set statusTitle = "All your training providers have now reached a decision" %}
{% elif status == "withdrawn" or status == "did-not-respond-to-offer" %}
  {% set statusTitle = "You have withdrawn all your choices" %}
{% elif status == "pending-conditions" %}
  {% set statusTitle = "You have accepted an offer" %}
  {% set statusDesc = "We’ve sent you an email to confirm this. Your training provider will be in touch with you directly to explain what happens next." %}
{% elif status == "offer-deferred" %}
  {% set statusTitle = "Your original offer has been deferred" %}
  {% set statusDesc = "We’ve sent you an email to confirm this. Your training provider will be in touch with you directly to explain what happens next." %}
{% elif status == "recruited" or status == "recruited-single" %}
  {% set statusTitle = "You have met your conditions and are ready to be enrolled" %}
  {% set statusDesc = "Your training provider will be in touch with you directly to explain what happens next." %}
{% else %}
  {% if application.choices | toArray | length > 1 %}
    {% set statusTitle = "Courses you’ve applied to" %}
  {% else %}
    {% set statusTitle = "Course you’ve applied to" %}
  {% endif %}
  {% set statusDesc = "Training providers must respond by " + 56 | nowPlusDays("d MMMM yyyy") + "." %}
{% endif %}

{% block beforePageTitle %}
  {% if application.endedWithoutSuccess == true %}
    {{ govukNotificationBanner({
      html: "<p class=\"govuk-notification-banner__heading\">You did not get a place on a course this time. <a class=\"govuk-notification-banner__link\" href=\"" + applicationPath + "/apply-again\">Apply again</a>.</p>"
    }) }}
  {% endif %}
{% endblock %}

{% block beforePrimary %}
  <h1 class="govuk-heading-xl">{{ title | safe }}</h1>
  <!--<p class="govuk-hint govuk-!-margin-bottom-8">Application submitted on {{ "now" | date("d MMMM yyyy") }}. <a href="/application/{{ applicationId }}/submitted?referrer={{ referrer }}">View application</a></p>-->
{% endblock %}

{% block primary %}

  {% set canMakeDecision = (status == "awaiting-provider-decisions") or (status == "awaiting-candidate-response" or status == "offer-received") %}

  {% set respondToOfferHtml %}
    <p class="govuk-body-l govuk-!-font-weight-bold">You have received a conditional offer for a place.</p>
    <p class="govuk-body">You have until 4 March 2021 to accept or reject the offer.</p>
    {{ govukButton({
      text: "Respond to offer",
      href: "#"
    }) }}
  {% endset %}

  {% if canMakeDecision == true %}
    {{ govukNotificationBanner({
      html: respondToOfferHtml
    }) }}
  {% endif %}

  {% set choices = application.choices | toArray %}

  {% if choices | length > 1 %}

    <p class="govuk-body">You applied for {{ choices | length }} courses. All providers must respond by {{ 56 | nowPlusDays("d MMMM yyyy") }}</p>

    {% set statusHtml %}
      {{ govukTag({
        classes: "govuk-tag govuk-tag--blue",
        text: "Awaiting decision"
      }) }}


    {% endset %}


    {{ govukSummaryList({
      rows: [
        {
          key: {
            classes: "app-summary-list__key--wide",
            html: "<b>Gorse SCITT</b><br><a href=\"#\" class=\"govuk-!-font-weight-regular\">Primary (ABCD)</a>"
          },
          value: {
            classes: "app-summary-list__value--narrow",
            html: statusHtml
          }
        },
        {
          key: {
            classes: "app-summary-list__key--wide",
            html: "<b>Leeds Trinity University</b><br><a href=\"#\" class=\"govuk-!-font-weight-regular\">Primary (3-7) (2VLT)</a>"
          },
          value: {
            classes: "app-summary-list__value--narrow",
            html: statusHtml
          }
        },
        {
          key: {
            classes: "app-summary-list__key--wide",
            html: "<b>Bradford College</b><br><a href=\"#\" class=\"govuk-!-font-weight-regular\">Primary (X100)</a>"
          },
          value: {
            classes: "app-summary-list__value--narrow",
            html: statusHtml
          }
        }
      ]
    }) }}


  {% else %}

    {% set firstChoice = choices | first %}
    {% set firstChoiceProvider = providers[firstChoice["providerCode"]] %}
    {% set firstChoiceCourse = firstChoiceProvider.courses[firstChoice.courseCode] %}


    <p class="govuk-body-l">You applied for the <a href="https://find-postgraduate-teacher-training.education.gov.uk/course/{{ provider.code }}/{{ course.code }}">{{ firstChoiceCourse["name"] }}</a> course at {{ providers[firstChoice["providerCode"]]["name"] }}.</p>

  {% set statusHtml %}
    {{ govukTag({
      classes: "govuk-tag govuk-tag--blue",
      text: "Awaiting decision"
    }) }}

  <p class="govuk-!-margin-top-3">The provider must respond by {{ 56 | nowPlusDays("d MMMM yyyy") }}.</p>

  {% endset %}


  {{ govukSummaryList({
    classes: "govuk-summary-list--no-border",
    rows: [{
      key: {
        text: "Status"
      },
      value: {
        html: statusHtml
      },
      actions: {}
    },
    {
      key: { text: "Contact details" },
      value: { html: "0113 4871777 <br> <a href=\"mailto:info@gorsescitt.org.uk\">info@gorsescitt.org.uk</a>" }
    }

    ]
  }) }}
{% endif %}

<p class="govuk-body"><a href="#" class="govuk-link">View your application</a></p>

<h2 class="govuk-heading-m">What happens next?</h2>

<p class="govuk-body">The provider will review your application, and you may be invited to an interview. If the provider offers you a place, you will have 10 working days to either accept or reject the offer.</p>

<p class="govuk-body">You can <a href="#" class="govuk-link">withdraw your application</a> if you no longer want to apply for this course.</p>

<p class="govuk-body">If you are not offered a place, or you withdraw your application, you will be able to apply to a different course.</p>

{% from "govuk/components/table/macro.njk" import govukTable %}

{{ govukTable({
  caption: "Your previous applications",
  captionClasses: "app-table__caption--m",
  firstCellIsHeader: false,
  head: [
    {
      text: "Course"
    },
    {
      text: "Status"
    },
    {
      text: ""
    }
  ],
  rows: [
    [
      {
        html: "<a href=\"#\">Primary (ABC12)</a><br>2 Schools Consortium"
      },
      {
        html: "<strong class=\"govuk-tag govuk-tag govuk-tag--red\">Unsuccessful</strong>"
      },
      {
        html: "<a href=\"#\">View</a>"
      }
    ],
    [
      {
        html: "<a href=\"#\">Primary (XZ134)</a><br>Coventry University"
      },
      {
        html: "<strong class=\"govuk-tag govuk-tag govuk-tag--red\">Unsuccessful</strong>"
      },
      {
        html: "<a href=\"#\">View</a>"
      }
    ],
    [
      {
        html: "<a href=\"#\">Primary (XZ134)</a><br>Acorns Teaching School Alliance"
      },
      {
        html: "<strong class=\"govuk-tag govuk-tag govuk-tag--red\">Application withdrawn</strong>"
      },
      {
        html: "<a href=\"#\">View</a>"
      }
    ]
  ]
}) }}



{#
{{ govukButton({
  text: "Withdraw application",
  classes: "govuk-button--secondary"
}) }}
 #}
<!-- <p class="govuk-body"><a href="#" class="govuk-link">Withdraw</a></p>
 -->

<!--
  <p class="govuk-body-l">{{ statusTitle }}</p>

  <h2 class="govuk-heading-m govuk-!-font-size-27">{{ statusTitle }}</h2>
  {% if statusDesc %}
    <p class="govuk-body">{{ statusDesc }}</p>
  {% endif %}

  {% set showChoiceStatus = true %}
  {% set showChoiceFeedback = true %}
  {% include "_includes/review/choices.njk" %}
-->

{% endblock %}

{% block secondary %}
  {% include "_includes/get-support.njk" %}
  {% include "_includes/update-contact-details.njk" %}
{% endblock %}
